import React, { useState, useEffect, useRef } from 'react';
import { 
  Music, Video, Upload, Play, Pause, Download, Settings, 
  Wand2, Layers, Scissors, Share2, Music2, User, Sparkles, 
  Zap, Film, CreditCard, X, Check, Smartphone, QrCode,
  Volume2, Sliders, History, Database, ArrowRight, Save,
  Headphones, Activity, RefreshCw, Cpu, Globe, Mic, 
  HardDrive, Cloud, Star, MessageSquare, LayoutDashboard, 
  FileAudio, Eye, Heart, Search, Send, Trash2, Edit3, Plus, 
  Terminal, BarChart3, Radio, Monitor, ZapOff, Command,
  Waves, Repeat, SkipBack, SkipForward, Disc, List, ShoppingBag,
  Image as ImageIcon, Type, Camera, Palette, Box, Layers as LayersIcon
} from 'lucide-react';

// --- CONFIG & MOCK DATA ---
const AI_VOICES = [
  { id: 'v1', name: 'សុខា (ស្រី)', type: 'Soft', region: 'Phnom Penh' },
  { id: 'v2', name: 'ដារ៉ា (ប្រុស)', type: 'Bold', region: 'Siem Reap' },
  { id: 'v3', name: 'បុប្ផា (ស្រី)', type: 'Classic', region: 'Battambang' }
];

const App = () => {
  const [activeTab, setActiveTab] = useState('audio-gen'); // audio-gen, video-gen, voice-clone, library
  const [isProcessing, setIsProcessing] = useState(false);
  const [progress, setProgress] = useState(0);
  const [credits, setCredits] = useState(2500);
  const [isPlaying, setIsPlaying] = useState(false);
  const [mastered, setMastered] = useState(false);

  // --- UI EFFECTS ---
  useEffect(() => {
    // Quantum background logic...
  }, []);

  const handleAction = () => {
    setIsProcessing(true);
    setProgress(0);
    const interval = setInterval(() => {
      setProgress(prev => {
        if (prev >= 100) {
          clearInterval(interval);
          setIsProcessing(false);
          setMastered(true);
          setCredits(c => c - 50);
          return 100;
        }
        return prev + 2;
      });
    }, 50);
  };

  return (
    <div className="flex h-screen bg-[#050508] text-slate-200 font-sans overflow-hidden">
      {/* Sidebar Navigation */}
      <aside className="w-72 bg-black/50 border-r border-white/5 flex flex-col z-50 backdrop-blur-3xl">
        <div className="p-8">
          <div className="flex items-center gap-3 mb-10">
            <div className="w-10 h-10 bg-gradient-to-br from-pink-500 to-violet-600 rounded-xl flex items-center justify-center shadow-lg shadow-pink-500/20">
              <Sparkles className="text-white" size={20} />
            </div>
            <div>
              <h1 className="text-xl font-black tracking-tighter italic">KHMER<span className="text-pink-500">AI</span></h1>
              <p className="text-[8px] text-pink-500 font-bold uppercase tracking-widest">Ultimate Studio</p>
            </div>
          </div>

          <nav className="space-y-1.5">
            <SidebarButton icon={<Music size={18}/>} label="AI Audio Generator" active={activeTab === 'audio-gen'} onClick={() => setActiveTab('audio-gen')} />
            <SidebarButton icon={<Film size={18}/>} label="AI Video Creator" active={activeTab === 'video-gen'} onClick={() => setActiveTab('video-gen')} />
            <SidebarButton icon={<Mic size={18}/>} label="Voice Cloning" active={activeTab === 'voice-clone'} onClick={() => setActiveTab('voice-clone')} />
            <SidebarButton icon={<Database size={18}/>} label="Asset Library" active={activeTab === 'library'} onClick={() => setActiveTab('library')} />
          </nav>
        </div>

        <div className="mt-auto p-6">
          <div className="bg-gradient-to-br from-white/5 to-transparent border border-white/10 rounded-3xl p-6">
            <p className="text-[10px] font-black text-slate-500 uppercase mb-2">បណ្តុំថាមពល (Credits)</p>
            <h3 className="text-2xl font-black text-white">{credits.toLocaleString()}</h3>
            <button className="w-full mt-4 py-3 bg-pink-600 rounded-xl text-[10px] font-black hover:bg-pink-500 transition-all shadow-lg shadow-pink-500/20 uppercase">បញ្ចូលថាមពល</button>
          </div>
        </div>
      </aside>

      {/* Main Studio Area */}
      <main className="flex-1 flex flex-col relative overflow-hidden">
        {/* Header */}
        <header className="h-20 border-b border-white/5 flex items-center justify-between px-10 bg-black/20 backdrop-blur-md">
          <div className="flex items-center gap-6">
            <h2 className="text-sm font-black italic uppercase text-slate-400">
              {activeTab === 'audio-gen' && 'Audio Production Node'}
              {activeTab === 'video-gen' && 'Visual FX Engine'}
              {activeTab === 'voice-clone' && 'Neural Voice Synth'}
              {activeTab === 'library' && 'Project Management'}
            </h2>
          </div>
          <div className="flex items-center gap-4">
             <div className="bg-emerald-500/10 border border-emerald-500/20 px-4 py-1.5 rounded-full flex items-center gap-2">
                <div className="w-1.5 h-1.5 bg-emerald-500 rounded-full animate-pulse" />
                <span className="text-[10px] font-black text-emerald-500 uppercase">System Live</span>
             </div>
             <div className="w-10 h-10 rounded-full bg-white/5 border border-white/10 flex items-center justify-center">
                <User size={18} className="text-slate-400" />
             </div>
          </div>
        </header>

        {/* Content Viewport */}
        <div className="flex-1 overflow-y-auto p-10 scrollbar-hide">
          {activeTab === 'audio-gen' && <AudioGenView isProcessing={isProcessing} progress={progress} mastered={mastered} onGenerate={handleAction} />}
          {activeTab === 'video-gen' && <VideoGenView isProcessing={isProcessing} progress={progress} onGenerate={handleAction} />}
          {activeTab === 'voice-clone' && <VoiceCloneView />}
          {activeTab === 'library' && <LibraryView />}
        </div>
      </main>
    </div>
  );
};

// --- SUB-VIEWS ---

const AudioGenView = ({ isProcessing, progress, mastered, onGenerate }) => (
  <div className="grid grid-cols-12 gap-8 animate-in fade-in duration-700">
    <div className="col-span-8 space-y-8">
      <div className="bg-white/[0.02] border border-white/10 rounded-[2.5rem] p-10">
        <h3 className="text-2xl font-black italic mb-6">តើអ្នកចង់បង្កើតបទចម្រៀងបែបណា?</h3>
        <textarea 
          placeholder="ឧទាហរណ៍៖ បង្កើតបទចម្រៀងបែប R&B ទំនើប ជាមួយសំឡេងព្យាណូ និងចង្វាក់បុកខ្លាំង និយាយអំពីការនឹកស្រុក..."
          className="w-full h-40 bg-black/40 border border-white/10 rounded-2xl p-6 text-sm outline-none focus:border-pink-500 transition-all resize-none mb-6"
        />
        <div className="flex gap-4">
          <button className="px-6 py-3 bg-white/5 rounded-xl text-xs font-black flex items-center gap-2 hover:bg-white/10"><Music2 size={16}/> Style Template</button>
          <button className="px-6 py-3 bg-white/5 rounded-xl text-xs font-black flex items-center gap-2 hover:bg-white/10"><Mic size={16}/> Vocal Reference</button>
          <button onClick={onGenerate} className="ml-auto px-10 py-3 bg-gradient-to-r from-pink-600 to-violet-600 rounded-xl text-xs font-black shadow-xl hover:scale-105 active:scale-95 transition-all">GENERATE TRACK</button>
        </div>
      </div>

      <div className="bg-black/40 border border-white/10 rounded-[2.5rem] p-8">
        <h4 className="text-xs font-black text-slate-500 uppercase mb-6 flex items-center gap-2"><Layers size={14}/> Arrangement Stems</h4>
        <div className="space-y-4">
          <StemTrack label="Vocal (AI)" color="bg-pink-500" progress={80} />
          <StemTrack label="Melody Synth" color="bg-violet-500" progress={65} />
          <StemTrack label="Bass Line" color="bg-cyan-500" progress={90} />
          <StemTrack label="Drums / Perc" color="bg-emerald-500" progress={45} />
        </div>
      </div>
    </div>

    <div className="col-span-4 flex flex-col gap-6">
      <div className="bg-[#0b0b12] border border-white/10 rounded-[3rem] p-8 flex-1 flex flex-col shadow-2xl overflow-hidden relative">
        <div className="flex-1 bg-black rounded-[2rem] border border-white/5 flex flex-col items-center justify-center">
          <div className="relative">
            <Disc className={`text-pink-500 ${isProcessing ? 'animate-spin' : ''}`} size={120} />
            <div className="absolute inset-0 flex items-center justify-center">
              <div className="w-10 h-10 bg-black rounded-full border-2 border-pink-500" />
            </div>
          </div>
          {mastered && <p className="mt-8 text-xs font-black text-pink-500 uppercase tracking-widest animate-pulse">Mastered & Ready</p>}
        </div>
        
        <div className="mt-8">
          {isProcessing ? (
            <div className="space-y-4">
               <div className="flex justify-between text-[10px] font-black uppercase"><span className="text-slate-500">Processing Audio</span><span className="text-white">{progress}%</span></div>
               <div className="h-1.5 bg-slate-900 rounded-full overflow-hidden"><div className="h-full bg-pink-500 transition-all" style={{width: `${progress}%`}} /></div>
            </div>
          ) : mastered && (
            <div className="grid grid-cols-2 gap-3">
              <button className="py-4 bg-white/5 rounded-2xl text-[10px] font-black hover:bg-white/10 uppercase">Download WAV</button>
              <button className="py-4 bg-pink-600 rounded-2xl text-[10px] font-black hover:bg-pink-500 uppercase">Publish Track</button>
            </div>
          )}
        </div>
      </div>
    </div>
  </div>
);

const VideoGenView = ({ isProcessing, progress, onGenerate }) => (
  <div className="space-y-8 animate-in zoom-in-95 duration-700">
    <div className="flex justify-between items-end">
      <div>
        <h2 className="text-3xl font-black italic uppercase">AI Music Video Creator</h2>
        <p className="text-slate-500 text-sm mt-2">បង្កើតវីដេអូចម្រៀងស្អាតៗដោយស្វ័យប្រវត្តិជាមួយ AI។</p>
      </div>
    </div>
    <div className="grid grid-cols-12 gap-8">
      <div className="col-span-7 bg-white/[0.02] border border-white/10 rounded-[2.5rem] p-10 space-y-6">
        <div className="grid grid-cols-3 gap-4">
          <VisualCard icon={<ImageIcon size={24}/>} label="Image to Video" active />
          <VisualCard icon={<Type size={24}/>} label="Text to Video" />
          <VisualCard icon={<Camera size={24}/>} label="Scene Morph" />
        </div>
        <div className="space-y-4">
          <label className="text-[10px] font-black text-slate-500 uppercase">Upload Reference Style</label>
          <div className="h-48 border-2 border-dashed border-white/10 rounded-2xl flex flex-col items-center justify-center text-slate-500 hover:border-pink-500/50 hover:bg-pink-500/5 transition-all cursor-pointer">
            <Upload size={32} className="mb-4" />
            <p className="text-xs font-bold">បញ្ចូលរូបភាព ឬវីដេអូគំរូ</p>
          </div>
        </div>
        <button onClick={onGenerate} className="w-full py-4 bg-violet-600 rounded-xl font-black text-xs shadow-xl hover:bg-violet-500 transition-all uppercase">Render MV Engine</button>
      </div>
      <div className="col-span-5 bg-black rounded-[2.5rem] border border-white/10 p-4 relative flex items-center justify-center">
        {isProcessing ? (
          <div className="text-center">
            <RefreshCw className="mx-auto text-pink-500 animate-spin mb-4" size={40} />
            <p className="text-xs font-black uppercase tracking-widest">{progress}% Rendered</p>
          </div>
        ) : (
          <div className="text-center opacity-30">
            <Film size={60} className="mx-auto mb-4" />
            <p className="text-[10px] font-black uppercase">Preview Monitor Off</p>
          </div>
        )}
      </div>
    </div>
  </div>
);

const VoiceCloneView = () => (
  <div className="max-w-4xl mx-auto space-y-10 animate-in slide-in-from-bottom-8 duration-700">
    <div className="text-center space-y-4">
      <h2 className="text-4xl font-black italic tracking-tighter uppercase">Neural Voice Synth</h2>
      <p className="text-slate-400 max-w-lg mx-auto text-sm">បំប្លែងអត្ថបទទៅជាសំឡេងនិយាយ ឬច្រៀង ដោយប្រើបច្ចេកវិទ្យា Voice Cloning លំដាប់ខ្ពស់។</p>
    </div>
    
    <div className="grid grid-cols-2 gap-8">
      <div className="bg-white/[0.02] border border-white/10 rounded-[2.5rem] p-8">
        <h4 className="text-xs font-black text-slate-500 uppercase mb-6">ជ្រើសរើសសំឡេង AI</h4>
        <div className="space-y-3">
          {AI_VOICES.map(v => (
            <div key={v.id} className="p-4 bg-black/40 border border-white/5 rounded-2xl flex items-center justify-between group hover:border-pink-500 transition-all cursor-pointer">
              <div className="flex items-center gap-4">
                <div className="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center text-pink-500"><Mic size={18}/></div>
                <div>
                  <p className="font-bold text-sm text-white">{v.name}</p>
                  <p className="text-[10px] text-slate-500 uppercase">{v.type} • {v.region}</p>
                </div>
              </div>
              <Play size={16} className="text-slate-600 group-hover:text-pink-500" />
            </div>
          ))}
          <div className="p-4 border-2 border-dashed border-white/5 rounded-2xl flex items-center justify-center gap-3 text-slate-600 hover:text-white cursor-pointer hover:border-white/20 transition-all">
            <Plus size={18} /> <span className="text-[10px] font-black uppercase">Clone New Voice</span>
          </div>
        </div>
      </div>
      <div className="bg-white/[0.02] border border-white/10 rounded-[2.5rem] p-8 space-y-6">
        <h4 className="text-xs font-black text-slate-500 uppercase">បញ្ចូលអត្ថបទខ្មែរ</h4>
        <textarea className="w-full h-48 bg-black/40 border border-white/10 rounded-2xl p-6 text-sm outline-none focus:border-pink-500 transition-all resize-none" placeholder="សរសេរអត្ថបទនៅទីនេះ..." />
        <button className="w-full py-4 bg-white text-black rounded-xl font-black text-xs hover:bg-pink-500 hover:text-white transition-all uppercase">Synthesize Voice</button>
      </div>
    </div>
  </div>
);

const LibraryView = () => (
  <div className="space-y-8 animate-in fade-in duration-500">
    <div className="flex justify-between items-center">
       <h2 className="text-2xl font-black italic">បណ្ណាល័យគម្រោង (Project Library)</h2>
       <div className="flex gap-4">
          <button className="p-3 bg-white/5 rounded-xl text-slate-400 hover:text-white"><List size={18}/></button>
          <button className="p-3 bg-white/5 rounded-xl text-slate-400 hover:text-white"><Box size={18}/></button>
       </div>
    </div>
    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
       {[1,2,3,4,5,6].map(i => (
         <div key={i} className="bg-white/[0.02] border border-white/5 rounded-[2.5rem] p-6 hover:bg-white/[0.06] transition-all group">
            <div className="aspect-video bg-black rounded-2xl mb-6 flex items-center justify-center text-pink-500 group-hover:scale-[1.02] transition-transform">
               <Music2 size={40} />
            </div>
            <h4 className="font-bold text-white">Project_Untitled_#{i}</h4>
            <p className="text-[10px] text-slate-500 mt-1 uppercase font-mono">Audio • Mastered • 12MB</p>
            <div className="mt-6 pt-6 border-t border-white/5 flex items-center justify-between">
               <div className="flex gap-2">
                  <button className="p-2 bg-white/5 rounded-lg text-slate-500 hover:text-white"><Share2 size={14}/></button>
                  <button className="p-2 bg-white/5 rounded-lg text-slate-500 hover:text-white"><Download size={14}/></button>
               </div>
               <button className="px-5 py-2 bg-pink-600/10 text-pink-500 text-[10px] font-black rounded-lg hover:bg-pink-600 hover:text-white transition-all uppercase">Open Studio</button>
            </div>
         </div>
       ))}
    </div>
  </div>
);

// --- ATOMIC UI COMPONENTS ---

const SidebarButton = ({ icon, label, active, onClick }) => (
  <button onClick={onClick} className={`w-full flex items-center gap-4 px-5 py-3.5 rounded-2xl transition-all group ${active ? 'bg-white/10 text-white shadow-inner border border-white/5' : 'text-slate-500 hover:text-slate-200 hover:bg-white/[0.03]'}`}>
    <div className={`${active ? 'text-pink-500' : 'group-hover:text-pink-400'} transition-colors`}>{icon}</div>
    <span className="text-xs font-black tracking-tighter italic uppercase">{label}</span>
    {active && <div className="ml-auto w-1 h-5 bg-pink-500 rounded-full shadow-[0_0_10px_#ec4899]" />}
  </button>
);

const StemTrack = ({ label, color, progress }) => (
  <div className="flex items-center gap-4 bg-black/40 p-4 rounded-2xl border border-white/5 group hover:border-white/10 transition-all">
    <div className="w-28 text-[9px] font-black text-slate-400 uppercase tracking-widest">{label}</div>
    <div className="flex-1 h-10 bg-slate-950 rounded-xl relative overflow-hidden flex items-center px-4">
       <div className="flex gap-0.5 items-end opacity-20">
          {Array.from({length: 40}).map((_, i) => <div key={i} className={`w-0.5 rounded-full ${color}`} style={{height: `${Math.random()*24 + 4}px`}} />)}
       </div>
       <div className={`absolute top-0 left-0 bottom-0 ${color} opacity-10 transition-all`} style={{width: `${progress}%`}} />
       <div className="absolute top-0 bottom-0 w-0.5 bg-white/40 shadow-xl" style={{left: `${progress}%`}} />
    </div>
    <div className="flex gap-1.5 opacity-0 group-hover:opacity-100 transition-all">
       <button className="p-2 text-slate-600 hover:text-white"><Sliders size={14}/></button>
       <button className="p-2 text-slate-600 hover:text-red-500"><Trash2 size={14}/></button>
    </div>
  </div>
);

const VisualCard = ({ icon, label, active }) => (
  <div className={`p-6 rounded-2xl border text-center transition-all cursor-pointer ${active ? 'bg-white/10 border-pink-500 shadow-lg' : 'bg-black/40 border-white/5 hover:border-white/20'}`}>
    <div className={`mb-3 flex justify-center ${active ? 'text-pink-500' : 'text-slate-500'}`}>{icon}</div>
    <p className="text-[9px] font-black uppercase tracking-tighter text-white">{label}</p>
  </div>
);

export default App;
